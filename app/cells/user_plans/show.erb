<!-- Submenu for the plans list of a specified patient -->
<%= sub_menu %>

<div class="row col-lg-8 col-lg-offset-5">
  <% if user.profiled? %>
    <%= link_to new_plans_path(:u_id => user.id), method: 'post' do %>
      <button id="activities-user" class="btn btn-primary btn-large">
        <i class="material-icons">playlist_add</i> &nbsp Aggiungi Piano
      </button>
    <% end %>
  <% end %>
</div>




<div class="col-lg-12 col-md-12">


  <div class="card">
    <div class="card-header" data-background-color="orange">
      <h4 class="title">Attività e Piani</h4>

    </div>
    <div class="card-content table-responsive">

      <div>
        <% if plans.size == 0 %>
          <div id="no-info-grid" class="mdl-grid">
            <div class="mdl-cell--12-col-desktop mdl-cell--8-col-tablet mdl-cell--4-col-phone">
              <div id="no-info-card" class="mdl-card mdl-shadow--4dp">
                <div class="mdl-card__title mdl-card--expand">
                  <h2 class="mdl-card__title-text"> Nessuna Piano Presente </h2>
                </div>
                <div id="feature-card-supporting-text" class="mdl-card__supporting-text">

                  All'utente <%= user.last_name %> <%= user.first_name %> non e' stato ancora definito un piano da
                  seguire. Aggiungi un nuovo piano per iniziare!
                  <br>
                  Se ancora non puoi vedere il bottone AGGIUNGI UN NUOVO PIANO significa che il paziente non ha ancora
                  completato la fase di profilazione.

                </div>
              </div>
            </div>
          </div>
        <% end %>
      </div>




      <div id="user-plans-grid" class="mdl-grid" data-panel="true">
        <% plans.each do |plan| %>
          <div class="mdl-cell--12-col">
            <div class="plans-action"></div>
            <div class="plan-card-wide mdl-card mdl-shadow--2dp">
              <div class="<%= is_delivered?(plan) %>">
                <% if plan.delivered == 1 %>
                  <h2 class="mdl-card__title-text">Piano:&nbsp;&nbsp;<b><%= plan.name %></b>&nbsp;-&nbsp; in corso</h2>
                <% elsif plan.delivered == 0 %>
                  <h2 class="mdl-card__title-text">Piano:&nbsp;&nbsp;<b><%= plan.name %></b>&nbsp;-&nbsp; nuovo</h2>
                <% else %>
                  <h2 class="mdl-card__title-text">Piano:&nbsp;&nbsp;<b><%= plan.name %></b>&nbsp;-&nbsp;
                    portato a termine</h2>
                <% end %>
              </div>
              <div id="plan-supporting-text" class="mdl-card__supporting-text col-md-offset-3">
                <%= cell(:plan_description, plan) %>
              </div>












              <% if plan.plannings.empty? %>
                <i>Non sono presenti attivita' per questo piano al momento.</i>
              <% end %>

              <div class="plan-activities-container">
                <div class="accordion">
                  <% plan.plannings.each do |planning| %>












                    <h3 data-position="id_<%= planning.id %>" class="activity_style">Attività:&nbsp;&nbsp;<b><%= planning.activity.name %></b>


                      <div class="right-align-accordion-title ">
                        <div class="btn btn-warning btn-xs">Espandere</div>
                      </div>
                    </h3>
                    <div>
                      <%= cell(:planning_description, planning) %>
                      <%= cell(:schedules, planning) %>
                      <%= cell(:questions, planning) %>
                      <% if plan.delivered != 1 && plan.delivered != 4 %>

                        <%= link_to new_questions_path(:planning_id => planning.id, :u_id => plan.user.id, :p_id => plan.id), remote: true,
                                    method: 'get' do %>
                          <button class="btn btn-success btn-sm">
                            <i class="material-icons">alarm_add</i>&nbsp Aggiungi Domanda
                          </button>
                        <% end %>

                        <%= link_to planning_path(planning), method: 'delete' do %>
                          <button class="btn btn-warning btn-sm">
                            <i class="material-icons">highlight_off</i>&nbsp Destituisci Attività
                          </button>
                        <% end %>


                      <% end %>
                    </div>


                  <% end %>
                </div>
              </div>

              <div class="container col-md-2 middle_align">
                <% if plan.delivered == 0 %>
                  <%= link_to assign_plannings_path(:p_id => plan.id, :u_id => plan.user.id), remote: true, method:
                      'post' do %>
                    <button class="btn btn-primary btn-md">
                      <i class="material-icons">alarm_on</i>&nbsp Assegna attività
                    </button>
                  <% end %>

                  <%= link_to new_plannings_path(:p_id => plan.id, :u_id => plan.user.id), remote: true, method:
                      'post' do %>
                    <button class="btn btn-success btn-md">
                      <i class="material-icons">alarm_add</i> &nbsp Aggiungi attività
                    </button>
                  <% end %>

                  <%= link_to deliver_plans_path(:p_id => plan.id), method: 'post' do %>
                    <button class="btn btn-info btn-md">
                      <i class="material-icons">done_all</i> &nbsp Consegna attività
                    </button>
                  <% end %>
                <% end %>
                <%= link_to plan_path(:p_id => plan.id, :u_id => plan.user.id), method: 'delete', data: {confirm: 'Sei sicuro di voler eliminare il piano? Una volta eliminato non potra\' piu\'
                      essere ripristinato! Tuttavia le Attivita\' non verranno cancellate, ma le ritrovarai nella sezione Attivita\'!'} do %>
                  <button class="btn btn-danger btn-md">
                    <i class="material-icons">delete_forever</i> &nbsp Elimina attività
                  </button>
                <% end %>

              </div>
            </div>

          </div>

          <div id="lateral-panel-<%= plan.id %>" class="lateral-panel mdl-cell--5-col">

          </div>
        <% end %>

      </div>


    </div>
  </div>
</div>








