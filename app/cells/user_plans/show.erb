<% plans = user.plans %>

<!-- Submenu for the plans list of a specified patient -->
<% cell(:plans_submenu, user) %>

<div id="myTitle">
  <h5>Elenco PIANI di <%= user.last_name %> <%= user.first_name %></h5>
</div>

<div>
  <% if plans.size == 0 %>
      <div id="no-info-grid" class="mdl-grid">
        <div class="mdl-cell--12-col-desktop mdl-cell--8-col-tablet mdl-cell--4-col-phone">
          <div id="no-info-card" class="mdl-card mdl-shadow--4dp">
            <div class="mdl-card__title mdl-card--expand">
              <h2 class="mdl-card__title-text"> Nessuna Piano Presente </h2>
            </div>
            <div id="feature-card-supporting-text" class="mdl-card__supporting-text">

              All'utente <%= user.last_name %> <%= user.first_name %> non e' stato ancora definito un piano da seguire. Aggiungi un nuovo piano per iniziare!

            </div>
          </div>
        </div>
      </div>
  <% end %>
</div>

<div id="user-plans-grid" class="mdl-grid">

  <div class="mdl-cell--7-col">
    <div class="plans-action"></div>
    <% plans.each do |plan| %>
      <div class="plan-card-wide mdl-card mdl-shadow--2dp">
        <div class="<%= is_delivered?(plan) %>">
          <h2 class="mdl-card__title-text"> <%= plan.name %> </h2>
        </div>
        <div id="plan-supporting-text" class="mdl-card__supporting-text">
          <%= cell(:plan_description, plan) %>
        </div>

        <% if plan.plannings.empty? %>
            <i>Non sono presenti attivita' per questo piano al momento.</i>
        <% end %>

        <% plan.plannings.each do |planning| %>

            <div id="activity-expandible" class="mdl-card__actions mdl-card--border">
              <div class="activities-container">
                <details class="activity-expander mdl-expansion">
                  <summary class="mdl-expansion__summary">
                    <span id="activity-name-styler" class="mdl-expansion__header"><%= planning.activity.name %></span>
                  </summary>
                  <div class="mdl-expansion__content">

                    <%= cell(:planning_description, planning) %>
                    <%= cell(:schedules, planning) %>
                    <%= cell(:questions, planning) %>

                  </div>
                  <div class="mdl-expansion__actions">
                    <% if plan.delivered != 1 && plan.delivered != 3 %>
                        <%= link_to 'Aggiungi Domanda', new_questions_path(:a_id => planning.activity.id, :u_id => plan.user.id) ,
                                    method: 'get', class: 'mdl-button mdl-button--colored mdl-js-button mdl-js-ripple-effect' %>
                        <%= link_to 'Destituisci Attivita', planning_path(planning) ,
                                    method: 'delete', class: 'mdl-button mdl-button--accent mdl-js-button mdl-js-ripple-effect' %>
                    <% end %>
                  </div>
                </details>
              </div>
            </div>

        <% end %>

        <% if plan.delivered == 0 %>
            <%= link_to 'Assegna un\'attivita',
                        assign_plannings_path(:p_id => plan.id, :u_id => plan.user.id), remote: true, method: 'post', class: 'mdl-button mdl-button--colored mdl-js-button mdl-js-ripple-effect' %>
            <%= link_to 'Aggiungi un\'attivita',
                        new_plannings_path(:p_id => plan.id, :u_id => plan.user.id), remote: true, method: 'post', class: 'mdl-button mdl-button--colored mdl-js-button mdl-js-ripple-effect' %>
            <%= link_to 'Consegna',
                          deliver_plans_path(:p_id => plan.id), method: 'post',
                          class: 'mdl-button mdl-button--colored mdl-js-button mdl-js-ripple-effect'%>

        <% elsif plan.delivered == 1 %>
            <%= link_to 'Sospendi',
                          suspend_plans_path(:p_id => plan.id), method: 'post',
                          class: 'mdl-button mdl-button--colored mdl-js-button mdl-js-ripple-effect'%>
            <%= link_to 'Interrompi',
                          stop_plans_path(:p_id => plan.id), method: 'post',
                          class: 'mdl-button mdl-button--colored mdl-js-button mdl-js-ripple-effect'%>

        <% else %>
            <%= link_to 'Assegna un\'attivita',
                        assign_plannings_path(:p_id => plan.id, :u_id => plan.user.id), remote: true, method: 'post', class: 'mdl-button mdl-button--colored mdl-js-button mdl-js-ripple-effect' %>
            <%= link_to 'Aggiungi un\'attivita',
                        new_plannings_path(:p_id => plan.id, :u_id => plan.user.id), remote: true, method: 'post', class: 'mdl-button mdl-button--colored mdl-js-button mdl-js-ripple-effect' %>
            <%= link_to 'Riconsegna',
                          deliver_plans_path(:p_id => plan.id), method: 'post',
                          class: 'mdl-button mdl-button--colored mdl-js-button mdl-js-ripple-effect'%>

        <% end %>
        <%= link_to 'Elimina',
                      plan_path(:p_id => plan.id, :u_id => plan.user.id), method: 'delete',
                      class: 'pushRight mdl-button mdl-button--colored mdl-js-button mdl-js-ripple-effect mdl-button--accent',
                      data: {confirm: 'Sei sicuro di voler eliminare il piano? Una volta eliminato non potra\' piu\'
                      essere ripristinato! Tuttavia le Attivita\' non verranno cancellate, ma le ritrovarai nella sezione Attivita\'!'}%>
      </div>

    <% end %>
    <%= button_to new_plans_path(:u_id => user.id), class: 'mdl-button mdl-js-button mdl-button--raised mdl-button--colored', method: 'post' do %>
        Aggiungi un nuovo piano
    <% end %>
  </div>

  <div class="mdl-cell--5-col">
    <div id="lateral-panel">

    </div>
  </div>


</div>
